<div class="flex flex-col mb-6">
    <h4 class="font-bold text-3xl">Incident Management</h4>
    <p class="text-neutral-500">Monitor and manage active incidents across the city</p>
</div>

<!--Incident highlights -->
<div class="mt-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-5">
    @for (incident of incidentsSummary; track incident.title) {
        <cmrp-incident-highlight [incident]="incident"/>
    }
</div>

<div class="rounded-md shadow border border-dark-gray/50 flex flex-col gap-3 p-4 mt-6">
    <div class="flex items-center gap-4 justify-between">
        <div class="flex flex-col">
            <span class="font-bold text-3xl">Current Incidents</span>
            <p class="text-neutral-500">Active and ongoing incidents requiring attention</p>
        </div>

        <div class="flex items-center gap-4">
            <p-icon-field>
                <p-inputicon class="pi pi-search"/>
                <input pInputText placeholder="Search" type="search"/>
            </p-icon-field>

            <p-select [(ngModel)]="selectedFilter" [options]="filters" class="w-44"
                      optionLabel="name" placeholder="Select filter"
            />
        </div>
    </div>


    <!--Incidents table-->
    <p-table
            [paginator]="true"
            [rows]="10"
            [tableStyle]="{ 'min-width': '60rem' }"
            [value]="incidentTable"
            class="mt-5"
    >
        <ng-template #header>
            <tr>
                @for (header of incidentTableHeaders; track header) {

                    <th>{{ header | titlecase }}</th>
                }
            </tr>
        </ng-template>
        <ng-template #body let-incident>
            <tr>
                <td>{{ incident.id }}</td>
                <td>{{ incident.title }}</td>
                <td>{{ incident.location }}</td>
                <td>
                    <p-tag [rounded]="true" [severity]="getIncidentSeverity(incident.priority.toLowerCase())"
                           [value]="incident.priority"/>
                </td>
                <td>
                    <p-tag [rounded]="true" [severity]="getIncidentSeverity(incident.status.toLowerCase())"
                           [value]="incident.status"/>
                </td>
                <td>{{ incident.assignedOfficer }}</td>
                <td>{{ incident.reported }}</td>
                <td>
                    <div class="flex items-center gap-2">
                        <p-button
                                (click)="incidentAction(incident.id, false)"
                                (keyup)="incidentAction(incident.id, false)"
                                aria-label="view incident"
                                icon="pi pi-eye"
                                pTooltip="View incident"
                                tooltipPosition="top"
                                type="button"
                                variant="text"
                        />
                        <p-button
                                (click)="incidentAction(incident.id, true)"
                                (keyup)="incidentAction(incident.id, true)"
                                aria-label="update incident"
                                icon="pi pi-pencil"
                                pTooltip="Update incident"
                                tooltipPosition="top"
                                variant="text"
                        />
                    </div>
                </td>


            </tr>
        </ng-template>
        <ng-template #footer>
            <tr>
                <td colspan="8">In total there are {{ incidentTable ? incidentTable.length : 0 }} incidents.</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!--Incident details modal-->
@if (showIncidentDetailsModal) {
    <p-dialog [(visible)]="showIncidentDetailsModal" [modal]="true"
              [breakpoints]="{ '5199px': '30vw', '1699px': '45vw', '1199px': '55vw', '1029px': '75vw', '575px': '90vw' }"
              [style]="{ width: '50vw' }"
              [draggable]="false"
              [resizable]="false">
        <ng-template #header>
            <div class="flex flex-col">
                <span class="font-bold text-xl">{{ getIncidentDetails().title }}</span>
                <span class="text-neutral-500">incident details - {{ getIncidentDetails().id }}</span>
            </div>
        </ng-template>
        <cmrp-incident-details
                [showEditOptions]="showEditDetailsOptions()"
                [incident]="getIncidentDetails()"/>

        @if (showEditDetailsOptions()) {
            <ng-template #footer>
                <div class="flex items-center gap-4 justify-between">
                    <p-button (click)="showIncidentDetailsModal=false" label="Cancel" variant="outlined"/>
                    <button aria-label="Submit" pButton class="bg-primary!">Submit</button>
                </div>
            </ng-template>
        }
    </p-dialog>
}
